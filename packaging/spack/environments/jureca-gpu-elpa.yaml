# This is a Spack Environment file.
##docu Config for a specific computer: JURECA@JSC
##docu GPU version, using 2023 stage of modules
#
# It describes a set of packages to be installed, along with
# configuration settings.
#
#  IMPORTANT: you have to set the FLEUR_SOURCE environment variable to the FLEUR-root directory to find the
#             adjusted spack recipes in the repo included below!
#
spack:
  # add package specs to the `specs` list
  specs:
  - fleur@develop%nvhpc+cuda+elpa+mpi+hdf5 cuda_arch=80
  - elpa~openmp+cuda cuda_arch=80
  - netlib-scalapack
  view: true
  concretizer:
    unify: true
  repos:
  - ${FLEUR_SOURCE}/packaging/spack/repo
  packages:
    mpi:
      require: openmpi
    libtool:
      buildable: false
      externals:
      - spec: libtool@2.4.6
        prefix: /usr
    libxml2:
      buildable: false
      externals:
      - spec: libxml2@2.9
        modules: [Stages/2023, libxml2/.2.9.13]
    hdf5:
      buildable: false
      externals:
      - spec: hdf5@1.12
        modules: [Stages/2023, NVHPC, OpenMPI, HDF5]
    perl:
      buildable: false
      externals:
      - spec: perl@5.26.3~cpanm+opcode+open+shared+threads
        prefix: /usr
    python:
      externals:
      - spec: python@3.6.8+bz2+crypt+ctypes+dbm+lzma+nis+pyexpat~pythoncmd+readline+sqlite3+ssl~tkinter+uuid+zlib
        prefix: /usr
      buildable: false
    gmake:
      buildable: false
      externals:
      - spec: gmake@4.2.1
        prefix: /usr
    openmpi:
      buildable: false
      externals:
      - spec: openmpi@4.1.4
        modules: [Stages/2023, OpenMPI]
    all:
      variants:
      - cuda_arch=80
    cuda:
      buildable: false
      externals:
      - spec: cuda@11.7
        modules: [Stages/2023 CUDA/11]
    lapack:
      require: openblas
    cmake:
      buildable: false
      externals:
      - spec: cmake@3.26.3
        modules:
        - CMake
  compilers:
  - compiler:
      spec: nvhpc@=23.1
      paths:
        cc: /p/software/jurecadc/stages/2023/software/NVHPC/23.1/Linux_x86_64/23.1/compilers/bin/nvc
        cxx: /p/software/jurecadc/stages/2023/software/NVHPC/23.1/Linux_x86_64/23.1/compilers/bin/nvc++
        f77: /p/software/jurecadc/stages/2023/software/NVHPC/23.1/Linux_x86_64/23.1/compilers/bin/nvfortran
        fc: /p/software/jurecadc/stages/2023/software/NVHPC/23.1/Linux_x86_64/23.1/compilers/bin/nvfortran
      flags: {}
      operating_system: rocky8
      target: x86_64
      modules: [Stages/2023, OpenMPI, NVHPC]
      environment: {}
      extra_rpaths: []
  develop: {}
