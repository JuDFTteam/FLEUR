#juDFT Testscript

jt::copyfile("files/inp.xml",$workdir);

jt::testrun("$executable ",$workdir);

#Check that the ouput for crystalfield calculations is written
$result =jt::test_fileexists("$workdir/out");


if(jt::test_fileexists("$workdir/cdn.hdf") == 0){
   $result+=jt::test_fileexists("$workdir/CFdata.hdf");
}else{
   #Test for some of the text output files
   $result+=jt::test_fileexists("$workdir/n4f.1.dat");
   $result+=jt::test_fileexists("$workdir/V_20.1.dat");
   $result+=jt::test_fileexists("$workdir/V_40.1.dat");
   $result+=jt::test_fileexists("$workdir/V_60.1.dat");
   $result+=jt::test_fileexists("$workdir/V_66.1.dat");
}

#Test that there was a second vgen call with modified potential
#Here the big multipole moments are grepped (Maybe not the best way)
$result+=jt::test_grepexists("$workdir/out","0.14060E+01");
$result+=jt::test_grepexists("$workdir/out","0.82207E+00");
$result+=jt::test_grepexists("$workdir/out","0.89945E+00");
$result+=jt::test_grepexists("$workdir/out","0.65772E+01");

jt::stageresult($workdir,$result,"1");
